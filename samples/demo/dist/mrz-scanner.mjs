import{EnumCapturedResultItemType as e,EnumImagePixelFormat as t,CoreModule as n}from"dynamsoft-core";import*as i from"dynamsoft-core";export{i as Core};import{LicenseManager as s}from"dynamsoft-license";import*as a from"dynamsoft-license";export{a as License};import{CapturedResultReceiver as o,CaptureVisionRouter as r}from"dynamsoft-capture-vision-router";import*as c from"dynamsoft-capture-vision-router";export{c as CVR};import{Feedback as l,CameraView as d,CameraEnhancer as h}from"dynamsoft-camera-enhancer";import*as u from"dynamsoft-camera-enhancer";export{u as DCE};import{EnumValidationStatus as m,CodeParserModule as g}from"dynamsoft-code-parser";import*as p from"dynamsoft-code-parser";export{p as DCP};import{LabelRecognizerModule as f}from"dynamsoft-label-recognizer";import*as y from"dynamsoft-label-recognizer";export{y as DLR};import{MultiFrameResultCrossFilter as v}from"dynamsoft-utility";import*as w from"dynamsoft-utility";export{w as Utility};var S,E,R;!function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2",e.PassportAndTD1="passportAndTd1",e.PassportAndTD2="passportAndTd2",e.TD1AndTD2="td1AndTd2",e.All="all"}(S||(S={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2"}(E||(E={})),function(e){e.Scanner="scanner",e.Result="scan-result"}(R||(R={}));const C={[S.Passport]:"ReadPassport",[S.TD1]:"ReadId-TD1",[S.TD2]:"ReadId-TD2",[S.PassportAndTD1]:"ReadPassportAndId-TD1",[S.PassportAndTD2]:"ReadPassportAndId-TD2",[S.TD1AndTD2]:"ReadId",[S.All]:"ReadPassportAndId"};var D;function T(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}!function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(D||(D={}));function M(e,t){if(!document.getElementById(e)){const n=document.createElement("style");n.id=e,n.textContent=t,document.head.appendChild(n)}}const b=e=>!e||0===Object.keys(e).length;function x(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}const _={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};function I(e,t={}){const{message:n,spinnerSize:i=32}=t,s=document.createElement("div");s.className="dynamsoft-mrz-loading-screen";const a=document.createElement("div");a.className="dynamsoft-mrz-loading";const o=document.createElement("div");o.className="dynamsoft-mrz-loading-content";const r=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${i}" \n      height="${i}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(o.innerHTML=r,n){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=n,o.appendChild(e)}return a.appendChild(o),s.appendChild(a),e.appendChild(s),{element:s,updateMessage:e=>{let t=a.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,o.appendChild(t)):null==t||t.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout((()=>{var e;null===(e=s.parentNode)||void 0===e||e.removeChild(s)}),200))}}}const z='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var A;!function(e){e.InvalidFields="invalidFields",e.DocumentType="documentType",e.DocumentNumber="documentNumber",e.MRZText="mrzText",e.FirstName="firstName",e.LastName="lastName",e.Age="age",e.Sex="sex",e.IssuingState="issuingState",e.Nationality="nationality",e.DateOfBirth="dateOfBirth",e.DateOfExpiry="dateOfExpiry"}(A||(A={}));const V={[A.InvalidFields]:"Invalid Fields",[A.DocumentType]:"Document Type",[A.DocumentNumber]:"Document Number",[A.MRZText]:"MRZ Text",[A.FirstName]:"Given Name(s)",[A.LastName]:"Surname",[A.Age]:"Age",[A.Sex]:"Sex",[A.IssuingState]:"Issuing State",[A.Nationality]:"Nationality",[A.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[A.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)"};function L(e,t,n,i=!1){const s=parseInt(e,10);let a;if(i)a=s>=60?1900+s:2e3+s;else{a=s>(new Date).getFullYear()%100?1900+s:2e3+s}return{year:a,month:parseInt(t,10),day:parseInt(n,10)}}function k(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function F(e,t){const n=[],i=e=>t.getFieldValidationStatus(e)===m.VS_FAILED,s=t.codeType,a=function(e){switch(e){case"MRTD_TD1_ID":return E.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return E.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return E.Passport;default:throw new Error(`Unknown document type: ${e}`)}}(s),o=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(s),r=a===E.Passport&&"MRTD_TD3_PASSPORT"===s?"passportNumber":"documentNumber",c=L(t.getFieldValue("birthYear"),t.getFieldValue("birthMonth"),t.getFieldValue("birthDay")),l=L(t.getFieldValue("expiryYear"),t.getFieldValue("expiryMonth"),t.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach((e=>{i(e)&&n.push(A.DateOfBirth)})),["expiryYear","expiryMonth","expiryDay"].forEach((e=>{i(e)&&n.push(A.DateOfExpiry)}));const d={[A.LastName]:t.getFieldValue("primaryIdentifier"),[A.FirstName]:t.getFieldValue("secondaryIdentifier"),[A.Nationality]:t.getFieldRawValue("nationality"),[A.DocumentNumber]:t.getFieldValue(r)||t.getFieldValue("longDocumentNumber"),[A.IssuingState]:t.getFieldRawValue("issuingState"),[A.Sex]:x(t.getFieldValue("sex"))};Object.keys(d).forEach((e=>{let t=!1;switch(e){case A.FirstName:t=i("secondaryIdentifier");break;case A.LastName:t=i("primaryIdentifier");break;case A.DocumentNumber:t=i(r)||i("longDocumentNumber");break;default:t=i(e)}t&&n.push(e)}));const h=function(e){const t=new Date,n=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(n?0:1)}(c);h<1&&n.push(A.Age);return{[A.InvalidFields]:n,[A.FirstName]:d[A.FirstName],[A.LastName]:d[A.LastName],[A.Age]:h,[A.DateOfBirth]:c,[A.Sex]:d[A.Sex],[A.Nationality]:d[A.Nationality],[A.DocumentNumber]:d[A.DocumentNumber],[A.DateOfExpiry]:l,[A.IssuingState]:d[A.IssuingState],[A.DocumentType]:x(o),[A.MRZText]:e}}var N;!function(e){e.VIRTUAL_PASSPORT="virtual1",e.VIRTUAL_TD1="virtual2",e.VIRTUAL_TD2="virtual3",e.PHYSICAL_CAMERA="camera"}(N||(N={}));const O={[N.VIRTUAL_TD2]:"Virtual Camera 3: ID (TD2)",[N.VIRTUAL_TD1]:"Virtual Camera 2: ID (TD1)",[N.VIRTUAL_PASSPORT]:"Virtual Camera 1: Passport"},P={[E.TD1]:{width:85.6,height:53.98},[E.TD2]:{width:105,height:74},[E.Passport]:{width:125,height:88}};class j{showScannerLoadingOverlay(e){const t=T(this.config.container);this.loadingScreen=I(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(T(this.config.container).style.display="none"))}constructor(e,t){this.resources=e,this.config=t,this.demoScanningMode=N.PHYSICAL_CAMERA,this.demoScanningResolution="1080p",this.isSoundFeedbackOn=!1,this.scanModeManager={[E.Passport]:!0,[E.TD1]:!0,[E.TD2]:!0},this.currentScanMode=S.All,this.resizeTimer=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,soundFeedbackBtn:null,closeScannerBtn:null,scanModeSelectContainer:null,passportModeOption:null,td1ModeOption:null,td2ModeOption:null,toast:null},this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout((()=>{this.toggleScanGuide(!0)}),500)}}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),M("dynamsoft-mrz-loading-screen-style",z);try{const{cameraView:t,cameraEnhancer:n,cvRouter:i}=this.resources;if(t.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),t.setVideoFit("cover"),i.setInput(n),await i.initSettings(this.config.templateFilePath),!0===this.config.enableMultiFrameCrossFilter){const t=new v;t.enableResultCrossVerification(e.CRIT_TEXT_LINE,!0),t.enableResultDeduplication(e.CRIT_TEXT_LINE,!0),await i.addResultFilter(t)}const s=new o;s.onCapturedResultReceived=e=>this.handleMRZResult(e),await i.addResultReceiver(s),this.toggleSoundFeedback(!1),!1===this.config.showScanGuide&&this.toggleScanGuide(!1),this.initialized=!0}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"Dynamsoft MRZ Scanner initialize error"}};this.currentScanResolver(n)}}}initializeElements(){const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))throw new Error("Shadow root not found");this.DCE_ELEMENTS={selectCameraBtn:t.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:t.shadowRoot.querySelector(".dce-mn-upload-image-icon"),soundFeedbackBtn:t.shadowRoot.querySelector(".dce-mn-sound-feedback"),closeScannerBtn:t.shadowRoot.querySelector(".dce-mn-close"),scanModeSelectContainer:t.shadowRoot.querySelector(".dce-mn-scan-mode-select"),passportModeOption:t.shadowRoot.querySelector(".scan-mode-option-passport"),td1ModeOption:t.shadowRoot.querySelector(".scan-mode-option-td1"),td2ModeOption:t.shadowRoot.querySelector(".scan-mode-option-td2"),toast:t.shadowRoot.querySelector(".dce-mn-toast")},this.setupScanModeSelector(),this.assignDCEClickEvents(),this.DCE_ELEMENTS.toast.style.display="none",!1===this.config.showUploadImage&&(this.DCE_ELEMENTS.uploadImageBtn.style.display="none"),!1===this.config.showSoundToggle&&(this.DCE_ELEMENTS.soundFeedbackBtn.style.display="none"),this.initializedDCE=!0}setupScanModeSelector(){if(!1!==this.config.showFormatSelector)switch(this.currentScanMode){case S.PassportAndTD1:this.DCE_ELEMENTS.td2ModeOption.style.display="none";break;case S.PassportAndTD2:this.DCE_ELEMENTS.td1ModeOption.style.display="none";break;case S.TD1AndTD2:this.DCE_ELEMENTS.passportModeOption.style.display="none";break;case S.All:break;default:this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}else this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.uploadImageBtn.onclick=()=>this.uploadImage(),this.DCE_ELEMENTS.soundFeedbackBtn.onclick=()=>this.toggleSoundFeedback(),this.DCE_ELEMENTS.closeScannerBtn.onclick=()=>this.handleCloseBtn(),this.DCE_ELEMENTS.selectCameraBtn.onclick=e=>{e.stopPropagation(),this.toggleSelectCameraBox()},this.DCE_ELEMENTS.passportModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.passportModeOption.style.display&&await this.toggleScanDocType(E.Passport)},this.DCE_ELEMENTS.td1ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td1ModeOption.style.display&&await this.toggleScanDocType(E.TD1)},this.DCE_ELEMENTS.td2ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td2ModeOption.style.display&&await this.toggleScanDocType(E.TD2)}}handleCloseBtn(){this.closeCamera(),this.currentScanResolver&&this.currentScanResolver({status:{code:D.RS_CANCELLED,message:"Cancelled"}})}attachOptionClickListeners(){const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...t.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...t.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach((e=>{e.addEventListener("click",(async t=>{if("none"!==n.style.display&&(this.toggleSelectCameraBox(),!this._demo_IsFirefoxAndroid&&Object.keys(O).includes(this.demoScanningMode)))if(e.getAttribute("data-davice-id"))Object.keys(O).includes(e.getAttribute("data-davice-id"))||(this._demo_saveSelectedCamera(e.getAttribute("data-davice-id")),this._demo_playVideoWithRes("stop",N.PHYSICAL_CAMERA,e.getAttribute("data-davice-id")),this.demoScanningMode=N.PHYSICAL_CAMERA);else if(e.getAttribute("data-height")){let t;switch(e.getAttribute("data-height")){case"2160":t="4k";break;case"1440":t="2k";break;case"1080":t="1080p";break;case"720":t="720p";break;case"480":t="480p";break;default:return}this._demo_playVideoWithRes(t,this.demoScanningMode),this.demoScanningResolution=t}}))})),this._demo_AttachFakeEventsToCameras()}_demo_AttachFakeEventsToCameras(){if(this._demo_IsFirefoxAndroid)return;const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-cameras");n&&Object.keys(O).forEach((e=>{n.querySelector(`[data-davice-id="${e}"]`).onclick=async t=>{t.stopPropagation(),this._demo_playVideoWithRes("1080p",e),this.demoScanningMode=e,this._demo_saveSelectedCamera(e)}}))}_demo_CheckForFakeCamera(e){return Object.keys(O).some((t=>e===t&&this.demoScanningMode===t))}highlightCameraAndResolutionOption(){const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),i=n.querySelectorAll(".dce-mn-camera-option"),s=n.querySelectorAll(".dce-mn-resolution-option"),a=this.resources.cameraEnhancer.getSelectedCamera(),o=this.resources.cameraEnhancer.getResolution();i.forEach((e=>{const t=e,n=t.getAttribute("data-davice-id");this._demo_CheckForFakeCamera(n)||this.demoScanningMode===N.PHYSICAL_CAMERA&&n===(null==a?void 0:a.deviceId)?(t.style.border="2px solid #fe814a",this._demo_saveSelectedCamera(n)):t.style.border="none"}));const r={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},c=function(e){const t=e.width*e.height,n=e.width/e.height;let i="480p",s=Number.MAX_VALUE;for(const[e,a]of Object.entries(_)){const o=a.width*a.height,r=a.width/a.height,c=.7*Math.abs(o-t)+Math.abs(r-n)*o*.3;c<s&&(s=c,i=e)}return i}(o);s.forEach((e=>{const t=e,n=t.getAttribute("data-height");this.demoScanningMode!==N.PHYSICAL_CAMERA?n===r[this.demoScanningResolution]?t.style.border="2px solid #fe814a":t.style.border="none":t.style.border=n===r[c]?"2px solid #fe814a":"none"}))}toggleSelectCameraBox(){const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-resolution-box");this._demo_AddFakeCameras(),this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),n.click()}get _demo_IsFirefoxAndroid(){return navigator.userAgent.toLowerCase().includes("firefox")&&navigator.userAgent.toLowerCase().includes("android")}_demo_saveSelectedCamera(e){try{localStorage.setItem("dds-demo-save-selected-item",e)}catch(e){console.warn("Failed to save camera preference:",e)}}_demo_AddFakeCameras(){if(this._demo_IsFirefoxAndroid)return;const e=T(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-cameras");n&&Object.entries(O).forEach((([e,t])=>{if(!n.querySelector(`[data-davice-id="${e}"]`)){const i=document.createElement("div");i.className="dce-mn-camera-option",i.setAttribute("data-davice-id",e),i.innerText=t,n.prepend(i)}}))}async uploadImage(){var t,n,i;const{cvRouter:s}=this.resources,a=document.createElement("input");a.type="file",a.accept="image/*",a.style.display="none",document.body.appendChild(a);try{this.showScannerLoadingOverlay("Processing image..."),await this.closeCamera(!1);const o=await new Promise(((e,t)=>{a.onchange=n=>{var i;const s=null===(i=n.target.files)||void 0===i?void 0:i[0];(null==s?void 0:s.type.startsWith("image/"))?e(s):t(new Error("Please select an image file"))},a.addEventListener("cancel",(async()=>{this.hideScannerLoadingOverlay(!1),await this.launch(this.demoScanningMode)})),a.click()}));if(!o)return this.hideScannerLoadingOverlay(!1),void await this.launch(this.demoScanningMode);const r=this.config.utilizedTemplateNames[this.currentScanMode];if(!1!==this.config.showScanGuide){const e=await s.getSimplifiedSettings(r);e.roiMeasuredInPercentage=!0,e.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await s.updateSettings(r,e)}const c=await s.capture(o,r);this.capturedResultItems=c.items;const l=this.capturedResultItems.filter((t=>t.type===e.CRIT_ORIGINAL_IMAGE))[0].imageData;l.toCanvas=()=>{const e=document.createElement("canvas");e.width=l.width,e.height=l.height;const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");const n=new ImageData(new Uint8ClampedArray(l.bytes.buffer),l.width,l.height);return t.putImageData(n,0,0),e},this.originalImageData=l;const d=null==c?void 0:c.textLineResultItems,h=null==c?void 0:c.parsedResultItems;let u={};if(null==d?void 0:d.length){const e=(null===(t=d[0])||void 0===t?void 0:t.text)||"";u=F(e,h[0])}const m={status:{code:D.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,_imageData:this.originalImageData,data:u};null===(i=(n=this.resources).onResultUpdated)||void 0===i||i.call(n,m),this.currentScanResolver(m),this.hideScannerLoadingOverlay(!0)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"Error processing uploaded image"}};this.currentScanResolver(n)}finally{document.body.removeChild(a)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn;const t=T(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-mn-sound-feedback"),s=i.querySelector(".dce-mn-sound-feedback-on");i.querySelector(".dce-mn-sound-feedback-off").style.display=this.isSoundFeedbackOn?"none":"block",s.style.display=this.isSoundFeedbackOn?"block":"none"}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:n}=this.resources;if(!t||!t.isOpen())return;const i=n.getVisibleRegionOfVideo({inPixels:!0});if(!i)return;const s=n.getVideoElement(),a=s.videoWidth,o=s.videoHeight,r=P[e];let c;const l=i.height-80;if(i.width>i.height){c=.75*l/r.height;c*r.width>.9*i.width&&(c=.9*i.width/r.width)}else{c=.9*i.width/r.width;c*r.height>.75*l&&(c=.75*l/r.height)}const d=c*r.width,h=c*r.height,u=(i.width-d)/2,m=(l-h)/2,g=u,p=u+d,f=m,y=m+h,v=(i.x+g)/a*100,w=(i.x+p)/a*100,S=(i.y+f)/o*100,E=(i.y+y)/o*100,R={left:Math.round(v),right:Math.round(w),top:Math.round(S),bottom:Math.round(E),isMeasuredInPercentage:!0};null==n||n.setScanRegionMaskVisible(!0),t.setScanRegion(R)}toggleScanGuide(e){const t=T(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-scanguide-passport"),s=n.shadowRoot.querySelector(".dce-scanguide-td1"),a=n.shadowRoot.querySelector(".dce-scanguide-td2");if(!1===e||!1===this.config.showScanGuide)return i.style.display="none",s.style.display="none",void(a.style.display="none");switch(this.currentScanMode){case S.All:case S.Passport:case S.PassportAndTD1:case S.PassportAndTD2:i.style.display="block",s.style.display="none",a.style.display="none",this.calculateScanRegion(E.Passport);break;case S.TD1:case S.TD1AndTD2:i.style.display="none",s.style.display="block",a.style.display="none",this.calculateScanRegion(E.TD1);break;case S.TD2:i.style.display="none",s.style.display="none",a.style.display="block",this.calculateScanRegion(E.TD2)}}async openCamera(e=N.PHYSICAL_CAMERA){try{this.showScannerLoadingOverlay("Initializing camera...");const{cameraEnhancer:t,cameraView:n}=this.resources,i=T(this.config.container);if(i.style.display="block",!this._demo_IsFirefoxAndroid&&Object.keys(O).includes(e)){const s=n.getUIElement();s.parentElement||i.append(s),await t.open(),await this._demo_playVideoWithRes(this.demoScanningResolution,e,null,!0)}else if(t.isOpen())t.isPaused()&&await t.resume();else{const e=n.getUIElement();e.parentElement||T(this.config.container).append(e),await t.open()}if(this.toggleScanGuide(),this.demoScanningMode=this._demo_IsFirefoxAndroid?N.PHYSICAL_CAMERA:e,(!this.initializedDCE&&t.isOpen()||!this._demo_IsFirefoxAndroid&&Object.keys(O).includes(e))&&await this.initializeElements(),this._demo_saveSelectedCamera(e),this._demo_IsFirefoxAndroid||!Object.keys(O).includes(e)){this.demoScanningMode=N.PHYSICAL_CAMERA;const t=i.children[i.children.length-1];t.shadowRoot.querySelectorAll(".dce-mn-camera-option").forEach((t=>{t.getAttribute("data-davice-id")===e&&t.click()}))}window.addEventListener("resize",this.handleResize);const s=i.children[i.children.length-1];if(!(null==s?void 0:s.shadowRoot))throw new Error("Shadow root not found");s.shadowRoot.querySelector(".dce-mn-torch-off").style.display="none",s.shadowRoot.querySelector(".dce-mn-torch-on").style.display="none"}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"MRZ Scanner Open Camera Error"}};this.currentScanResolver(n)}finally{this.hideScannerLoadingOverlay()}}async _demo_playVideoWithRes(e,t,n,i){if(this._demo_IsFirefoxAndroid)return;const{cameraEnhancer:s}=this.resources;if(i||this.showScannerLoadingOverlay(`Opening ${(null==O?void 0:O[t])||"Camera"}`),s.close(),s.getVideoEl().setAttribute("crossOrigin","anonymous"),"stop"!==e){const n="https://tst.dynamsoft.com/temp/mrz-scanner/demo-video/",i=`${t}/`;s.videoSrc=`${n}${i}${e}-dynamsoft-sample-vid.mp4`,this._demo_saveSelectedCamera(t)}else s.videoSrc="",s.selectCamera(n),this._demo_saveSelectedCamera(n);s.open().then((()=>this.toggleScanGuide())),this.hideScannerLoadingOverlay(!1)}async closeCamera(e=!0){try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:t,cameraView:n}=this.resources,i=T(this.config.container);i.style.display=e?"none":"block",(null==n?void 0:n.getUIElement().parentElement)&&i.removeChild(n.getUIElement()),t.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}async handleMRZResult(t){var n;if(this.capturedResultItems=t.items,!(t.items.length<=1))try{const{onResultUpdated:i}=this.resources,s=t.items.filter((t=>t.type===e.CRIT_ORIGINAL_IMAGE));this.originalImageData=s.length&&s[0].imageData;const a=null==t?void 0:t.textLineResultItems,o=null==t?void 0:t.parsedResultItems;if(a){this.isSoundFeedbackOn&&l.beep();const e=(null===(n=null==a?void 0:a[0])||void 0===n?void 0:n.text)||"",t=F(e,o[0]);this.closeCamera();const s={status:{code:D.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,_imageData:this.originalImageData,data:t};null==i||i(s),this.currentScanResolver(s)}}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"Error capturing image"}};this.currentScanResolver(n)}}initializeScanModeManager(){const{mrzFormatType:e}=this.config;if(this.scanModeManager={[E.Passport]:!0,[E.TD1]:!0,[E.TD2]:!0},!e||Array.isArray(e)&&0===e.length)return;Object.keys(this.scanModeManager).forEach((e=>{this.scanModeManager[e]=!1}));(Array.isArray(e)?e:[e]).forEach((e=>{this.scanModeManager[e]=!0}))}getScanMode(){const e=Object.entries(this.scanModeManager).filter((([e,t])=>t)).map((([e])=>e)).sort().join(",");return{[E.Passport]:S.Passport,[E.TD1]:S.TD1,[E.TD2]:S.TD2,[`${E.Passport},${E.TD1}`]:S.PassportAndTD1,[`${E.Passport},${E.TD2}`]:S.PassportAndTD2,[`${E.TD1},${E.TD2}`]:S.TD1AndTD2,[`${E.Passport},${E.TD1},${E.TD2}`]:S.All,"":S.All}[e]}DCEShowToast(e,t=3e3){this.DCE_ELEMENTS.toast&&(this.DCE_ELEMENTS.toast.textContent=e,this.DCE_ELEMENTS.toast.style.display="",setTimeout((()=>{this.DCE_ELEMENTS.toast.style.display="none"}),t))}async startCapturing(){const{cvRouter:e,cameraEnhancer:n}=this.resources,i=this.config.utilizedTemplateNames[this.currentScanMode];try{if(!1!==this.config.showScanGuide){const t=await e.getSimplifiedSettings(i);t.roiMeasuredInPercentage=!0,t.roi.points=[{x:0,y:50},{x:100,y:50},{x:100,y:100},{x:0,y:100}],await e.updateSettings(i,t)}await e.startCapturing(i),n.setPixelFormat(t.IPF_ABGR_8888)}catch(e){let t=(null==e?void 0:e.message)||e;console.error("Failed to start capturing:",t),this.closeCamera(),this.currentScanResolver&&this.currentScanResolver({status:{code:D.RS_FAILED,message:"Failed to start capturing"}})}}async toggleScanDocType(e){try{if(this.scanModeManager[e]&&0===Object.entries(this.scanModeManager).filter((([t,n])=>n&&t!==e)).length)return console.warn("MRZ Scanner - At least one mode must be enabled"),void this.DCEShowToast("At least one mode must be enabled");this.scanModeManager[e]=!this.scanModeManager[e],this.currentScanMode=this.getScanMode(),this.stopCapturing(),await this.startCapturing(),this.toggleScanGuide(),this.DCE_ELEMENTS.td1ModeOption.classList.toggle("selected",this.scanModeManager[E.TD1]),this.DCE_ELEMENTS.td2ModeOption.classList.toggle("selected",this.scanModeManager[E.TD2]),this.DCE_ELEMENTS.passportModeOption.classList.toggle("selected",this.scanModeManager[E.Passport])}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner switch scan mode error: ",t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"MRZ Scanner switch scan mode error"}};this.currentScanResolver(n)}}async launch(e){try{await this.initialize();const{cvRouter:t,cameraEnhancer:n}=this.resources;return new Promise((async t=>{this.currentScanResolver=t,await this.openCamera(e||this.demoScanningMode),(!this.initializedDCE&&n.isOpen()||!this._demo_IsFirefoxAndroid&&Object.keys(O).includes(e))&&await this.initializeElements(),await this.startCapturing(),this.toggleScanGuide()}))}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner launch error: ",t),this.closeCamera();const n={status:{code:D.RS_FAILED,message:"MRZ Scanner launch error"}};this.currentScanResolver(n)}}}const B={rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class ${constructor(e,t,n){this.resources=e,this.config=t,this.scannerView=n,this.editedFields={}}async launch(){try{return T(this.config.container).textContent="",await this.initialize(),T(this.config.container).style.display="flex",new Promise((e=>{this.currentScanResultViewResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){var e;try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const t=await this.scannerView.launch();if((null===(e=null==t?void 0:t.status)||void 0===e?void 0:e.code)===D.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(t));this.resources.onResultUpdated&&((null==t?void 0:t.status.code)===D.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==t?void 0:t.status.code)===D.RS_SUCCESS&&this.resources.onResultUpdated(t)),this.dispose(!0),await this.initialize(),T(this.config.container).style.display="flex"}catch(e){throw console.error("Error in rescan handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:D.RS_FAILED,message:(null==e?void 0:e.message)||e}}),e}}async handleDone(){var e,t;try{(null===(e=this.resources.result)||void 0===e?void 0:e.data)&&!b(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(e){throw console.error("Error in done handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:D.RS_FAILED,message:(null==e?void 0:e.message)||e}}),e}}createControls(){var e,t,n,i,s,a,o,r;const{toolbarButtonsConfig:c}=this.config;return function(e){M("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach((e=>{const n=document.createElement("div");n.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const i=document.createElement("div");if(i.className="dynamsoft-mrz-control-icon-wrapper",(s=e.icon).trim().startsWith("<svg")&&s.trim().endsWith("</svg>"))i.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,i.appendChild(t)}var s;const a=document.createElement("div");a.className="dynamsoft-mrz-control-text",a.textContent=e.label,e.isDisabled&&n.classList.add("disabled"),e.isHidden&&n.classList.add("hide"),n.appendChild(i),n.appendChild(a),e.onClick&&!e.isDisabled&&n.addEventListener("click",e.onClick),t.appendChild(n)})),t}([{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(e=null==c?void 0:c.rescan)||void 0===e?void 0:e.icon)||B.rescan,label:(null===(t=null==c?void 0:c.rescan)||void 0===t?void 0:t.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(n=null==c?void 0:c.rescan)||void 0===n?void 0:n.className)||""}`,isHidden:(null===(i=null==c?void 0:c.rescan)||void 0===i?void 0:i.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(s=null==c?void 0:c.done)||void 0===s?void 0:s.icon)||B.complete,label:(null===(a=null==c?void 0:c.done)||void 0===a?void 0:a.label)||"Done",className:`${(null===(o=null==c?void 0:c.done)||void 0===o?void 0:o.className)||""}`,isHidden:(null===(r=null==c?void 0:c.done)||void 0===r?void 0:r.isHidden)||!1,onClick:()=>this.handleDone()}])}handleFieldEdit(e,t){if(e===A.DateOfBirth||e===A.DateOfExpiry)try{const[n,i,s]=t.split(/[\/\-\.]/);s&&i&&n&&(this.editedFields[e]={day:parseInt(s,10),month:parseInt(i,10),year:parseInt(n,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[e]=t}createMRZDataDisplay(){var e;const t=(null===(e=this.resources.result)||void 0===e?void 0:e.data)||{},n=!!this.config.allowResultEditing,i=t.invalidFields||[],s=document.createElement("div");if(s.className="dynamsoft-mrz-data-container",b(t)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText="No MRZ detected. Please try again.",s.appendChild(e),s}if(i.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${B.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${n?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,s.appendChild(e)}else if(0===i.length&&n){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${B.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,s.appendChild(e)}return Object.entries(t).forEach((([e,t])=>{var a;if(e===A.InvalidFields||!t)return;if(e===A.MRZText&&!1===(null===(a=this.config)||void 0===a?void 0:a.showMRZText))return;const o=document.createElement("div");o.className="dynamsoft-mrz-data-row";const r=i.includes(e);r&&o.classList.add("invalid-field");const c=[A.MRZText,A.DocumentType],l=document.createElement("span");if(l.className="dynamsoft-mrz-data-label",l.innerText=V[e]||e,r){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=B.failed,l.appendChild(e),n){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",l.appendChild(e)}}const d=document.createElement("div");if(d.className="dynamsoft-mrz-data-value",n&&!c.includes(e)){const n=document.createElement("input");n.className="dynamsoft-mrz-data-input",r&&n.classList.add("invalid"),e===A.DateOfBirth||e===A.DateOfExpiry?(n.value=k(t),n.setAttribute("placeholder","YYYY-MM-DD")):n.value=t,n.addEventListener("input",(t=>{if(this.handleFieldEdit(e,t.target.value),r){n.classList.remove("invalid"),o.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...i]);const t=this.editedFields.invalidFields.indexOf(e);t>-1&&this.editedFields.invalidFields.splice(t,1)}})),d.appendChild(n)}else e===A.MRZText?(d.classList.add("code"),d.innerText=t):e===A.DateOfBirth||e===A.DateOfExpiry?d.innerText=k(t):d.innerText=t,r&&d.classList.add("invalid-value");o.appendChild(l),o.appendChild(d),s.appendChild(o)})),s}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");M("dynamsoft-mrz-result-view-style",U);const e=document.createElement("div");if(e.className="dynamsoft-mrz-result-view-container",!1!==this.config.showOriginalImage){const t=this.resources.result.originalImageResult,n=document.createElement("div");let i;n.className="dynamsoft-mrz-result-view-image-container",(null==t?void 0:t.toCanvas)&&(i=null==t?void 0:t.toCanvas()),Object.assign(i.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),n.appendChild(i),e.appendChild(n)}const t=this.createMRZDataDisplay();e.appendChild(t);const n=this.createControls();e.appendChild(n),T(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){T(this.config.container).style.display="none"}dispose(e=!1){T(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const U="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-result-view-image-container {\n      width: 100%;\n          height: 200px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n          background-color: #323234;\n          }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: rgba(196, 231, 60, 0.2);\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-result-view-image-container{\n      flex: 1;\n      height: 100%;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",q={rootDirectory:"https://cdn.jsdelivr.net/npm/"};class H{showLoadingOverlay(e){var t,n;const i=T(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||T(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen=I(i,{message:e}),i.style.display="block",i.style.position="relative"}hideLoadingOverlay(e=!1){var t,n,i;const s=T(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||T(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(s.style.display="none",(null===(i=this.config)||void 0===i?void 0:i.container)&&(T(this.config.container).style.display="none")))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null}async initialize(){if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};M("dynamsoft-mrz-loading-screen-style",z),this.showLoadingOverlay("Loading...");if(!await this.initializeDCVResources())return this.hideLoadingOverlay(!0),console.error("Failed to initialize DCV resources"),{resources:this.resources,components:{}};this.resources.onResultUpdated=e=>{this.resources.result=e};const e={};return this.config.scannerViewConfig&&(this.scannerView=new j(this.resources,this.config.scannerViewConfig),e.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new $(this.resources,this.config.resultViewConfig,this.scannerView),e.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:e}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;return alert(t),console.error(t),{resources:this.resources,components:{}}}finally{this.hideLoadingOverlay(!0)}}async initializeDCVResources(){var e,t,i;try{return s.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",!0),n.engineResourcePaths=b(null===(t=this.config)||void 0===t?void 0:t.engineResourcePaths)?q:this.config.engineResourcePaths,n.loadWasm(["DLR","DCP"]),g.loadSpec("MRTD_TD3_PASSPORT"),g.loadSpec("MRTD_TD1_ID"),g.loadSpec("MRTD_TD2_ID"),f.loadRecognitionData("MRZ"),this.resources.cameraView=await d.createInstance(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath),this.resources.cameraEnhancer=await h.createInstance(this.resources.cameraView),this.resources.cvRouter=await r.createInstance(),!0}catch(e){let t=(null==e?void 0:e.message)||e;if(null==t?void 0:t.toLowerCase().includes("license")){const e="The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.";alert(e),console.error(e)}else{const e=`Resource Initialization Failed: ${t}`;alert(e),console.error(e)}return!1}}shouldCreateDefaultContainer(){var e,t;const n=!this.config.container,i=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return n&&i}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,n,i,s,a,o,r;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)&&(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!T(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)&&!T(null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)&&!T(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var e,t,n,i,s,a,o;this.config=null!==(e=this.config)&&void 0!==e?e:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=T(this.config.container));const r=this.config.container?this.createViewContainers(T(this.config.container)):{},c={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(S).map((e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||C[e]]}))),templateFilePath:(null===(t=this.config)||void 0===t?void 0:t.templateFilePath)||"https://cdn.jsdelivr.net/npm/dynamsoft-mrz-scanner@2.0.0/dist/mrz-scanner.template.json"},l=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:r[R.Scanner]||T(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath)||"https://cdn.jsdelivr.net/npm/dynamsoft-mrz-scanner@2.0.0/dist/mrz-scanner.ui.html",templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(a=null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.enableMultiFrameCrossFilter)||void 0===a||a,mrzFormatType:this.config.mrzFormatType}),d=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{container:r[R.Result]||T(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},c),{scannerViewConfig:l,resultViewConfig:d})),!0}createViewContainers(e){e.textContent="";const t=[R.Scanner];return this.showResultView()&&t.push(R.Result),t.reduce(((t,n)=>{const i=document.createElement("div");return i.className=`mrz-scanner-${n}-view-container`,Object.assign(i.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(i),t[n]=i,t}),{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const n=e=>{const t=T(e);t&&(t.style.display="none",t.textContent="")};n(this.config.container),n(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),n(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async launch(e){try{if(this.isCapturing){const e="Capture session already in progress";return alert(e),console.error(e),{status:{code:D.RS_FAILED,message:e}}}this.isCapturing=!0;const{components:t}=await this.initialize();if(b(t))throw new Error("MRZ Scanner initialization failed.");if(this.config.container&&(T(this.config.container).style.display="block"),!t.scannerView&&this.resources.result&&t.resultView)return await t.resultView.launch();if(!t.scannerView&&!this.resources.result)throw Error("Scanner view is required when no previous result exists");if(t.scannerView){const n=await t.scannerView.launch(e);if((null==n?void 0:n.status.code)!==D.RS_SUCCESS)return{status:{code:null==n?void 0:n.status.code,message:(null==n?void 0:n.status.message)||"Failed to capture image"}};if(t.resultView)return await t.resultView.launch()}return this.resources.result}catch(e){return alert((null==e?void 0:e.message)||e),console.error((null==e?void 0:e.message)||e),{status:{code:D.RS_FAILED,message:(null==e?void 0:e.message)||e}}}finally{this.isCapturing=!1,this.dispose()}}}const Z={MRZScanner:H,MRZScannerView:j,MRZResultView:$};export{C as DEFAULT_TEMPLATE_NAMES,Z as DynamsoftMRZScanner,A as EnumMRZData,E as EnumMRZDocumentType,S as EnumMRZScanMode,R as EnumMRZScannerViews,D as EnumResultStatus,V as MRZDataLabel,$ as MRZResultView,H as MRZScanner,j as MRZScannerView,k as displayMRZDate};
